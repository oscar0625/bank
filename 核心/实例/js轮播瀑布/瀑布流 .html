<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="initialize.css">
    <style>
        .out {
            position: relative;
            margin: 0 auto;
        }
        .in {
            float: left;
        }
        .img {
            margin: 10px;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #666;
            box-shadow: 0 0 5px #ff7ba5;

        }
    </style>
</head>
<body>
<div class="out">
    <!--<div class="in">
        <div class="img">
            <img src="" alt="">
        </div>
    </div>-->
    <div class="in">
        <div class="img"><img src="img/i1.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i2.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i3.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i4.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i5.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i6.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i7.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i8.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i9.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i10.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i11.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i12.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i13.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i14.jpg" alt=""/></div>
    </div>
    <div class="in">
        <div class="img"><img src="img/i15.jpg" alt=""/></div>
    </div>
</div>
<script>
    window.onload=function(){
        var imaDate = {
            "data": [{"src": "i1.jpg"}, {"src": "i2.jpg"}, {"src": "i3.jpg"}, {"src": "i4.jpg"}, {"src": "i5.jpg"}, {"src": "i6.jpg"}, {"src": "i7.jpg"}, {"src": "i8.jpg"}, {"src": "i9.jpg"}, {"src": "i10.jpg"}, {"src": "i11.jpg"}, {"src": "i12.jpg"}, {"src": "i13.jpg"}, {"src": "i14.jpg"}, {"src": "i15.jpg"}]
        };
        var out=document.getElementsByClassName("out").item(0);
        var myin=document.getElementsByClassName("in"); //动态的

    /*第一次执行瀑布流*/
    function pbl(){
        var num=Math.floor(document.documentElement.clientWidth/myin[0].offsetWidth);
        out.style.width=num*myin[0].offsetWidth+"px";
        var heiht=[];
        for(var i=0;i<myin.length;i++){
            if(i<num){
//            myin[i].style.float="left";
                heiht.push(myin[i].offsetHeight);
                myin[i].style.position="static";
            }else{
                myin[i].style.position="absolute";
                var mytop=Math.min.apply(null,heiht);
                var index=heiht.indexOf(mytop);
                myin[i].style.top=mytop+"px";
                myin[i].style.left=index*myin[0].offsetWidth+"px";
                heiht[index]=heiht[index]+myin[i].offsetHeight;

            }
        }
    }
    pbl();
    /*滚动时加元素*/
    window.onscroll=function(){
        if(pd()){
            for(var i=0;i<imaDate.data.length;i++){
                var div1=document.createElement("div");
                div1.className="in";
                var div2=document.createElement("div");
                div2.className="img";
                var img=new Image;
                img.src="img/"+imaDate.data[i].src;
                div2.appendChild(img);
                div1.appendChild(div2);
                out.appendChild(div1);
            }
            pbl();

        }
    };
    /*判断滚动*/
    function pd(){
        var h1=document.documentElement.scrollTop||document.body.scrollTop;
        var h2=document.documentElement.clientHeight;
        var h3=myin[myin.length-1].offsetTop;
        if((h1+h2)>=h3){
            return true
        }
    }
    /*页面改变*/
        window.onresize=function(){
            pbl();
        }
    };



















    /*
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    *
    * */
</script>
</body>
</html>
