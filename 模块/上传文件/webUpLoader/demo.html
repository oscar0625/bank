<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!--资源-->
    <link rel="stylesheet" href="webuploader/webuploader.css">
    <script src="jquery-1.10.2.min.js"></script>
    <script src="webuploader/webuploader.min.js"></script>

</head>
<body>
<!--dom-->
<div id="uploader" class="wu-example">
    <!--用来存放item-->
    <div id="thelist" class="uploader-list"></div>

    <div class="btns" id="drop">
        <!--核心-->
        <div id="picker">选择文件</div>
        <button id="ctlBtn" class="btn btn-default">开始上传</button>
    </div>
</div>
</body>

<script>
    /*http://fex.baidu.com/webuploader/getting-started.html*/

    var $wrap = $("#uploader");         //拖拽容器
    var $list = $("#thelist");          //存放信息的列表
    var $btn = $("#ctlBtn");          //上传按钮
    var thumbnailWidth = 100;        //缩略图高度和宽度 （单位是像素），当宽高度是0~1的时候，是按照百分比计算，具体可以看api文档
    var thumbnailHeight = 100;

    // 初始化Web Uploader
    var uploader = WebUploader.create({
        // swf文件路径
        swf: './webuploader/Uploader.swf',

        // 文件接收服务端。
        server: 'http://www.sci.com/Handler/companyinfo.ashx',

        // 指定选择文件的按钮容器，不指定则不创建按钮。对应 核心
        pick: {
            id: '#picker',
            multiple: false  //不允许一次选择多个文件 默认允许true
        },

        // 只允许选择图片文件。
        accept: {
            title: 'Images',
            extensions: 'gif,jpg,jpeg,bmp,png',        // 允许的文件后缀
            mimeTypes: 'image/jpg,image/jpeg,image/png'
        },

        //        auto: true,          // 选完文件后，是否自动上传。
        //        chunked: true,       // 开起分片上传。
        //
        //        formData:{},         //文件上传请求的参数表，每次发送都会发送此对象中的参数。
        //        fileVal:'file',      //设置文件上传域的name。默认值：'file'
        //        method:'post',       //文件上传方式，POST或者GET。
//                duplicate :true ,     //支持反复选择  默认值可以2次
        fileNumLimit: 300,    //验证文件总数量, 超出则不允许加入队列。
        fileSizeLimit: 5 * 1024 * 1024,    // 200 M  //验证文件总大小是否超出限制, 超出则不允许加入队列。
        fileSingleSizeLimit: 1 * 1024 * 1024,   // 50 M  //验证单个文件大小是否超出限制, 超出则不允许加入队列。

        //拖动图片到窗口上传功能
        dnd: $wrap,              //指定允许拖拽的容器
        disableGlobalDnd: false,
        paste: document.body,    //此功能为通过粘贴来添加截屏的图片。建议设置为document.body
    });

    // 当有文件被添加进队列的时候触发
    uploader.on('fileQueued', function (file) {
        var $li = $(
                        '<div id="' + file.id + '" class="file-item thumbnail">' +
                        '<img src="" />' +       /*指定一个失效的路径*/
                        '<div class="info">' + file.name + '</div>' +
                        '</div>'
                ),
                $img = $li.find('img');
        // $list为容器jQuery实例
        $list.html($li);

        // 创建缩略图  如果为非图片文件，可以不用调用此方法。
        // thumbnailWidth x thumbnailHeight 为 100 x 100
        uploader.makeThumb(file, function (error, src) {
            if (error) {
                /*不操作*/
                return;
            }
            $img.attr('src', src);
        }, thumbnailWidth, thumbnailHeight);
    });

    // 文件上传过程中创建进度条实时显示。
    uploader.on('uploadProgress', function (file, percentage) {
        var $li = $('#' + file.id),
                $percent = $li.find('.progress .progress-bar');

        // 避免重复创建
        if (!$percent.length) {
            $percent = $('<div class="progress progress-striped active">' +
                    '<div class="progress-bar" role="progressbar" style="width: 0%;height:20px;background:red;">' +
                    '</div>' +
                    '</div>').appendTo($li).find('.progress-bar');
        }
        //console.log(percentage)
        $percent.css('width', percentage * 100 + '%');
    });

    //文件成功、失败处理
    uploader.on('uploadSuccess', function (file, response) {
        console.log("上传成功");
    });

    uploader.on('uploadError', function (file) {
        var $li = $( '#'+file.id ),
                $error = $li.find('div.error');

        // 避免重复创建
        if ( !$error.length ) {
            $error = $('<div class="error"></div>').appendTo( $li );
        }

        $error.text('上传失败');

    });
    //上传完成进度条消失
    uploader.on('uploadComplete', function (file) {
        $('#' + file.id).find('.progress').fadeOut();
    });

    //当验证不通过时,会以派送错误事件的形式通知调用者。
    uploader.on('error',function (code) {
        //code
        //===Q_EXCEED_NUM_LIMIT     在设置了fileNumLimit且尝试给uploader添加的文件数量超出这个值时派送。
        //===Q_EXCEED_SIZE_LIMIT    在设置了fileSizeLimit且尝试给uploader添加的文件总大小超出这个值时派送。
        //===Q_TYPE_DENIED          当文件类型不满足时触发
        //===F_DUPLICATE            当上传的文件出现重复的情况下
    });


    //上传
    $btn.on('click', function () {
        uploader.upload();
    });





</script>

</html>